<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPE TRACKER - Inicio de Sesión</title>
    <!-- Incluir Bootstrap CSS para utilidad de layout -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- Incluir Font Awesome (para el ícono de Google, aunque usaremos un SVG para mayor fidelidad) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Variables y Estilos Generales */
        :root {
            --dark-bg: #2c3e50; /* Azul marino oscuro, usado como fondo en las imágenes */
            --card-bg: #ffffff; /* Blanco para la tarjeta principal */
            --text-dark: #34495e; /* Texto oscuro */
            --accent-orange: #e67e22; /* Naranja vibrante para botones */
            --accent-hover: #d66910;
            --border-color: #bdc3c7; /* Gris claro para bordes */
        }

        body {
            background-color: var(--dark-bg);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem; /* Padding para móvil */
        }

        /* ------------------ TARJETA DE LOGIN ------------------ */
        .login-card {
            background-color: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }
        .login-header {
            text-align: center;
            padding-bottom: 60px;
            font-weight: 700;
            font-size: 1.5rem;
        }

        /* Contenedor de Tabs (Inicia Sesión / Regístrate) */
        .tab-container {
            display: flex;
            border-bottom: 2px solid #ecf0f1;
            margin-bottom: 2rem;
        }

        .tab {
            flex-grow: 1;
            text-align: center;
            padding: 0.75rem 0;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-dark);
            transition: all 0.2s;
            border: none;
            background: none;
            border-radius: 0.25rem;
            margin: 0 0.25rem;
        }

        .tab.active {
            background-color: var(--accent-orange);
            color: white;
        }

        /* Botón de Google */
        .btn-google {
            background-color: var(--card-bg);
            color: var(--text-dark);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            width: 100%;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .btn-google:hover {
            background-color: #f8f9fa;
        }
        
        /* SVG de Google para mejor visualización */
        .google-icon {
            margin-right: 0.75rem;
        }
        
        /* Separador 'o' */
        .separator {
            text-align: center;
            margin: 1.5rem 0;
            position: relative;
            color: var(--border-color);
            font-size: 0.9rem;
        }

        .separator::before,
        .separator::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background-color: #ecf0f1;
        }

        .separator::before {
            left: 0;
        }

        .separator::after {
            right: 0;
        }

        /* Campos de Formulario */
        .form-control {
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
            font-size: 1rem;
        }

        .form-control:focus {
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 0.1rem rgba(230, 126, 34, 0.5); /* Sombra naranja */
        }
        
        /* Botón de Iniciar Sesión / Enviar */
        .btn-main {
            background-color: var(--accent-orange);
            color: var(--card-bg);
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            width: 100%;
            font-weight: 600;
            transition: background-color 0.2s;
            margin-top: 0.5rem;
        }

        .btn-main:hover {
            background-color: var(--accent-hover);
        }
        
        /* Enlace de recuperación */
        .action-link {
            display: block;
            text-align: center;
            margin-top: 1.5rem;
            color: var(--accent-orange);
            font-weight: 500;
            text-decoration: none;
            font-size: 0.9rem;
        }
        .action-link:hover {
            color: var(--accent-hover);
        }
        
        /* Footer de la tarjeta */
        .card-footer-info {
            text-align: center;
            color: var(--border-color);
            font-size: 0.75rem;
            margin-top: 1rem;
        }

        /* Estilos para la ayuda de usuarios demo */
        .demo-users-help {
            display: block;
            margin-bottom: 1rem;
            color: var(--border-color);
        }

        .demo-users-help .title {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .demo-users-help .users {
            display: block;
            padding-left: 0.5rem;
        }

        /* Estilos para campos readonly */
        .form-control[readonly] {
            background-color: #f8f9fa;
            cursor: not-allowed;
        }

        /* Estilos para campo de código de verificación */
        #verify-code {
            font-size: 1.5rem;
            letter-spacing: 0.5rem;
            text-align: center;
            font-weight: 600;
        }

        .modal-header {
            background-color: var(--accent-hover);
        }

        .alert {
            background-color: var(--border-color);
        }

        .modal-footer .btn-primary {
            background-color: var(--accent-hover);
            border-color: var(--accent-orange);
        }

    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            
            emailInput.addEventListener('change', function() {
                const selectedEmail = this.value;
                if (selectedEmail === 'atleta@test.com' || selectedEmail === 'entrenador@test.com') {
                    passwordInput.value = 'demo123';
                } else {
                    passwordInput.value = '';
                }
            });
        });
    </script>
</head>
<body>

    <div class="login-card">
        <div class="login-header">
                <a class="navbar-brand" href="#">
        <i class="bi bi-bar-chart-steps"></i> RPE TRACKER
    </a>
            </div>
        <!-- ======================= VISTA DE INICIO DE SESIÓN ======================= -->
        <div id="login-view">
            
            <!-- Contenedor de Tabs (Botones) -->
            <div class="tab-container">
                <button class="tab active" id="tab-login">Inicia Sesión</button>
                <button class="tab tab-register" id="tab-register">Regístrate</button>
            </div>

            <!-- Opción de Google -->
            <!--button class="btn btn-google">
                <svg class="google-icon" width="20" height="20" viewBox="0 0 48 48">
                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.23l6.59-6.59C34.46 3.73 29.56 2 24 2 15.65 2 8.38 5.6 3.96 11.23l7.98 6.18C13.56 12.83 18.46 9.5 24 9.5z"/>
                    <path fill="#4285F4" d="M46.7 24.5h-2.1c0-.85-.1-1.67-.2-2.49h-10.7v4.61h6.29c-.68 3.51-2.9 6.25-6.09 8.27l6.23 4.84c3.81-3.66 6.09-8.79 6.09-15.23z"/>
                    <path fill="#FBBC05" d="M12.94 28.59c-.27-.8-.41-1.64-.41-2.59s.14-1.79.41-2.59L5.95 17.5C4.24 21.04 3.2 25.1 3.2 29.5c0 4.41 1.04 8.46 2.75 12.01l6.99-5.41c-.27-.8-.41-1.64-.41-2.51z"/>
                    <path fill="#34A853" d="M24 45.5c5.54 0 10.44-1.73 14.07-4.57l-6.23-4.84c-3.19 2.02-5.91 4.76-6.09 8.27h-10.7c-.1-1.25-.2-2.49-.2-3.79s.1-2.54.2-3.79H24z"/>
                </svg>
                Continuar con Google
            </button-->

            <!-- Separador -->
            <!--div class="separator">o</div-->

            <!-- Formulario de Email/Contraseña -->
            <form id="login-form">
                <input type="email" 
                       class="form-control" 
                       placeholder="Email" 
                       id="email" 
                       list="demo-users"
                       required>
                <datalist id="demo-users">
                    <option value="atleta@test.com">
                    <option value="entrenador@test.com">
                </datalist>
                <small class="demo-users-help">
                    <span class="title">Usuarios demo:</span>
                    <span class="users">
                        atleta@test.com<br>
                        entrenador@test.com<br>
                        (Contraseña para ambos: demo123)
                    </span>
                </small>
                <input type="password" class="form-control" placeholder="Contraseña" id="password" required>
                
                <button type="submit" class="btn btn-main" id="btn-login-submit">Iniciar Sesión</button>
            </form>

            <a href="#" class="action-link" id="forgot-password-link">Recuperar contraseña</a>
        </div>

        <!-- ======================= VISTA DE REGISTRO ======================= -->
        <div id="register-view" style="display: none;">
            <!-- Contenedor de Tabs (Botones) -->
            <div class="tab-container">
                <button class="tab" id="tab-login-reg">Inicia Sesión</button>
                <button class="tab active tab-register" id="tab-register-reg">Regístrate</button>
            </div>

            <!-- Opción de Google -->
            <!--button class="btn btn-google">
                <svg class="google-icon" width="20" height="20" viewBox="0 0 48 48">
                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.23l6.59-6.59C34.46 3.73 29.56 2 24 2 15.65 2 8.38 5.6 3.96 11.23l7.98 6.18C13.56 12.83 18.46 9.5 24 9.5z"/>
                    <path fill="#4285F4" d="M46.7 24.5h-2.1c0-.85-.1-1.67-.2-2.49h-10.7v4.61h6.29c-.68 3.51-2.9 6.25-6.09 8.27l6.23 4.84c3.81-3.66 6.09-8.79 6.09-15.23z"/>
                    <path fill="#FBBC05" d="M12.94 28.59c-.27-.8-.41-1.64-.41-2.59s.14-1.79.41-2.59L5.95 17.5C4.24 21.04 3.2 25.1 3.2 29.5c0 4.41 1.04 8.46 2.75 12.01l6.99-5.41c-.27-.8-.41-1.64-.41-2.51z"/>
                    <path fill="#34A853" d="M24 45.5c5.54 0 10.44-1.73 14.07-4.57l-6.23-4.84c-3.19 2.02-5.91 4.76-6.09 8.27h-10.7c-.1-1.25-.2-2.49-.2-3.79s.1-2.54.2-3.79H24z"/>
                </svg>
                Continuar con Google
            </button-->

            <!-- Separador -->
            <!--div class="separator">o</div-->

            <!-- Formulario de Registro -->
            <form id="register-form">
                <div class="row">
                    <div class="col-6">
                        <input type="text" 
                               class="form-control" 
                               placeholder="Nombre" 
                               id="register-nombre" 
                               required>
                    </div>
                    <div class="col-6">
                        <input type="text" 
                               class="form-control" 
                               placeholder="Apellido" 
                               id="register-apellido" 
                               required>
                    </div>
                </div>
                <input type="email" 
                       class="form-control" 
                       placeholder="Email" 
                       id="register-email" 
                       required>
                <input type="password" 
                       class="form-control" 
                       placeholder="Contraseña" 
                       id="register-password" 
                       required>
                <input type="password" 
                       class="form-control" 
                       placeholder="Confirmar Contraseña" 
                       id="register-password-confirm" 
                       required>
                
                <div class="form-check mb-3">
                    <input class="form-check-input" type="radio" name="userType" id="typeAtleta" value="atleta" required>
                    <label class="form-check-label" for="typeAtleta">
                        Soy Atleta
                    </label>
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="radio" name="userType" id="typeEntrenador" value="entrenador">
                    <label class="form-check-label" for="typeEntrenador">
                        Soy Entrenador
                    </label>
                </div>
                
                <button type="submit" class="btn btn-main" id="btn-register-submit">Crear Cuenta</button>
            </form>
        </div>


        <!-- ======================= VISTA DE RECUPERAR CONTRASEÑA ======================= -->
        <div id="forgot-password-view" style="display: none;">
             <h2 class="h4 fw-bold mb-3" style="color: var(--text-dark);">Recuperar Contraseña</h2>
             <p class="mb-4" style="color: var(--text-dark); font-size: 0.95rem;">
                Ingresa tu email para recibir instrucciones y crear una nueva contraseña.
             </p>
             
             <form id="recover-form">
                <!-- El diseño tiene dos campos de email, probablemente para confirmación, pero usaremos uno solo para la funcionalidad básica de recuperación -->
                <input type="email" class="form-control" placeholder="Email" id="recover-email" required>
                <!-- Aunque la imagen muestra otro campo de email, la lógica estándar usa solo uno aquí -->
                 <input type="email" class="form-control" placeholder="Email (Confirmación)" id="recover-email-confirm" required>
                 
                 <button type="submit" class="btn btn-main" id="btn-recover-submit">Enviar instrucciones</button>
             </form>

             <a href="#" class="action-link" id="back-to-login-link">Volver a Iniciar Sesión</a>
        </div>

        <!-- ======================= VISTA DE CÓDIGO DE VERIFICACIÓN ======================= -->
        <div id="verify-code-view" style="display: none;">
            <h2 class="h4 fw-bold mb-3" style="color: var(--text-dark);">Código de Verificación</h2>
            <p class="mb-4" style="color: var(--text-dark); font-size: 0.95rem;">
                Ingresa el código de verificación que enviamos a tu email y tu nueva contraseña.
            </p>
            
            <form id="verify-code-form">
                <input type="email" class="form-control mb-3" placeholder="Email" id="verify-email" required readonly>
                <input type="text" class="form-control mb-3" placeholder="Código de 6 dígitos" id="verify-code" maxlength="6" pattern="[0-9]{6}" required>
                <small class="text-muted d-block mb-3">Ingresa el código de 6 dígitos que recibiste.</small>
                <input type="password" class="form-control mb-3" placeholder="Nueva contraseña" id="verify-new-password" required>
                <input type="password" class="form-control mb-3" placeholder="Confirmar nueva contraseña" id="verify-confirm-password" required>
                
                <button type="submit" class="btn btn-main" id="btn-verify-submit">Cambiar Contraseña</button>
            </form>
            
            <a href="#" class="action-link" id="back-to-recover-link">Volver</a>
        </div>

        <!-- Footer de la tarjeta (Común a ambas vistas) -->
        <div class="card-footer-info">
            © 2025 RPE Tracker V0.1.0
        </div>
    </div>

    <!-- Contenedor para Toasts de Bootstrap -->
    <div class="toast-container top-0 start-50 translate-middle-x" style="z-index: 9999;">
        <div id="toastNotification" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notificación</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Mensaje aquí
            </div>
        </div>
    </div>

    <script>
        // ==================== FUNCIONES HELPER PARA LOCALSTORAGE ====================
        
        /**
         * Obtiene todos los usuarios desde localStorage
         * @returns {Array} Array de usuarios o array vacío si no existen
         */
        function getUsers() {
            const users = localStorage.getItem('rpe-tracker-users');
            return users ? JSON.parse(users) : [];
        }
        
        /**
         * Guarda el array de usuarios en localStorage
         * @param {Array} users - Array de usuarios a guardar
         */
        function saveUsers(users) {
            localStorage.setItem('rpe-tracker-users', JSON.stringify(users));
        }
        
        /**
         * Busca un usuario por email en localStorage
         * @param {string} email - Email del usuario a buscar
         * @returns {Object|null} Usuario encontrado o null si no existe
         */
        function findUserByEmail(email) {
            const users = getUsers();
            return users.find(user => user.email === email) || null;
        }
        
        /**
         * Obtiene el usuario actualmente autenticado desde sessionStorage
         * @returns {Object|null} Usuario actual o null si no hay sesión
         */
        function getCurrentUser() {
            const user = sessionStorage.getItem('rpe-tracker-current-user');
            return user ? JSON.parse(user) : null;
        }
        
        /**
         * Guarda el usuario actual en sessionStorage
         * @param {Object} user - Usuario a guardar como usuario actual
         */
        function setCurrentUser(user) {
            sessionStorage.setItem('rpe-tracker-current-user', JSON.stringify(user));
        }
        
        /**
         * Busca un usuario por ID
         * @param {string} userId - ID del usuario a buscar
         * @returns {Object|null} Usuario encontrado o null si no existe
         */
        function getUserById(userId) {
            const users = getUsers();
            return users.find(user => user.id === userId) || null;
        }
        
        /**
         * Actualiza un usuario existente en localStorage
         * @param {string} userId - ID del usuario a actualizar
         * @param {Object} updates - Objeto con los campos a actualizar
         * @returns {boolean} true si se actualizó correctamente, false si no se encontró
         */
        function updateUser(userId, updates) {
            const users = getUsers();
            const userIndex = users.findIndex(user => user.id === userId);
            
            if (userIndex === -1) {
                return false;
            }
            
            users[userIndex] = { ...users[userIndex], ...updates };
            saveUsers(users);
            return true;
        }
        
        /**
         * Crea los datos por defecto según el tipo de usuario
         * @param {string} userType - Tipo de usuario: 'atleta' o 'entrenador'
         * @returns {Object} Objeto con los datos por defecto
         */
        function createDefaultUserData(userType) {
            if (userType === 'atleta') {
                return {
                    telefono: null,
                    nivel: null,
                    entrenadorId: null,
                    estadisticas: {
                        rpePromedio: null,
                        duracionPromedioSesion: null,
                        volumen: null,
                        frecuencia: null
                    },
                    notificaciones: {
                        email: true,
                        aplicacion: true
                    },
                    privacidad: {
                        perfilPublico: false,
                        compartirStats: false
                    },
                    sesiones: []
                };
            } else if (userType === 'entrenador') {
                return {
                    emailProfesional: null,
                    especialidad: null,
                    certificaciones: null,
                    atletasAsignados: [],
                    notificaciones: {
                        alertasSesionesCompletadas: true,
                        alertasRPEFueraRango: true,
                        resumenDiario: false
                    },
                    preferenciasPlanes: {
                        vistaPredeterminadaCalendario: "semanal",
                        rangoRPEDefecto: "6-8",
                        autoAsignarPlanes: false
                    }
                };
            }
            return {};
        }
        
        /**
         * Genera un ID único para el usuario
         * @returns {string} ID único generado
         */
        function generateUserId() {
            return Date.now().toString(36) + Math.random().toString(36).slice(2);
        }

        /**
         * Genera un código de verificación de 6 dígitos
         * @returns {string} Código de 6 dígitos
         */
        function generateVerificationCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        /**
         * Guarda un código de verificación en localStorage
         * @param {string} email - Email del usuario
         * @param {string} code - Código de verificación
         */
        function saveVerificationCode(email, code) {
            const verificationData = {
                email: email,
                code: code,
                expiresAt: Date.now() + (10 * 60 * 1000) // 10 minutos
            };
            localStorage.setItem('rpe-tracker-verification-code', JSON.stringify(verificationData));
        }

        /**
         * Verifica si un código es válido
         * @param {string} email - Email del usuario
         * @param {string} code - Código a verificar
         * @returns {boolean} true si el código es válido
         */
        function verifyCode(email, code) {
            const stored = localStorage.getItem('rpe-tracker-verification-code');
            if (!stored) return false;
            
            const verificationData = JSON.parse(stored);
            
            // Verificar que no haya expirado
            if (Date.now() > verificationData.expiresAt) {
                localStorage.removeItem('rpe-tracker-verification-code');
                return false;
            }
            
            // Verificar email y código
            return verificationData.email === email && verificationData.code === code;
        }

        /**
         * Cambia la contraseña de un usuario
         * @param {string} email - Email del usuario
         * @param {string} newPassword - Nueva contraseña
         * @returns {boolean} true si se cambió correctamente
         */
        function changeUserPassword(email, newPassword) {
            const users = getUsers();
            const userIndex = users.findIndex(user => user.email === email);
            
            if (userIndex === -1) {
                return false;
            }
            
            users[userIndex].password = newPassword;
            saveUsers(users);
            
            // Eliminar código de verificación usado
            localStorage.removeItem('rpe-tracker-verification-code');
            
            return true;
        }

        /**
         * Muestra un toast de Bootstrap
         * @param {string} message - Mensaje a mostrar
         * @param {string} type - Tipo: 'success', 'error', 'warning', 'info'
         * @param {string} title - Título opcional
         */
        function showToast(message, type = 'info', title = null) {
            // Verificar que Bootstrap esté cargado
            if (typeof bootstrap === 'undefined') {
                console.error('Bootstrap no está cargado. Usando alert como fallback.');
                alert(message);
                return;
            }
            
            const toastEl = document.getElementById('toastNotification');
            const toastTitleEl = document.getElementById('toastTitle');
            const toastMessageEl = document.getElementById('toastMessage');
            
            if (!toastEl || !toastTitleEl || !toastMessageEl) {
                console.error('Elementos del toast no encontrados. Usando alert como fallback.');
                alert(message);
                return;
            }
            
            // Configurar título
            if (title) {
                toastTitleEl.textContent = title;
            } else {
                // Títulos por defecto según el tipo
                const titles = {
                    'success': 'Éxito',
                    'error': 'Error',
                    'warning': 'Advertencia',
                    'info': 'Información'
                };
                toastTitleEl.textContent = titles[type] || 'Notificación';
            }
            
            // Configurar mensaje
            toastMessageEl.textContent = message;
            
            // Configurar colores según el tipo
            const toastHeader = toastEl.querySelector('.toast-header');
            const toastBody = toastEl.querySelector('.toast-body');
            
            // Remover clases de color previas
            toastHeader.classList.remove('bg-success', 'bg-danger', 'bg-warning', 'bg-info', 'text-white', 'text-dark');
            toastBody.classList.remove('bg-success', 'bg-danger', 'bg-warning', 'bg-info');
            
            // Agregar clases según el tipo
            if (type === 'success') {
                toastHeader.classList.add('bg-success', 'text-white');
                toastBody.classList.add('bg-success', 'bg-opacity-10');
            } else if (type === 'error') {
                toastHeader.classList.add('bg-danger', 'text-white');
                toastBody.classList.add('bg-danger', 'bg-opacity-10');
            } else if (type === 'warning') {
                toastHeader.classList.add('bg-warning', 'text-dark');
                toastBody.classList.add('bg-warning', 'bg-opacity-10');
            } else {
                toastHeader.classList.add('bg-info', 'text-white');
                toastBody.classList.add('bg-info', 'bg-opacity-10');
            }
            
            // Mostrar el toast
            const toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: type === 'error' ? 5000 : 3000 // Errores se muestran más tiempo
            });
            toast.show();
        }

        /**
         * Muestra un modal con el código de verificación (solo para simulación)
         * @param {string} email - Email del usuario
         * @param {string} code - Código de verificación
         * @param {Function} showViewCallback - Función callback para cambiar de vista
         */
        function showVerificationCodeModal(email, code, showViewCallback) {
            // Verificar que Bootstrap esté cargado
            if (typeof bootstrap === 'undefined') {
                alert(`Código de verificación para ${email}: ${code}\n\nEste código expira en 10 minutos.`);
                if (showViewCallback) {
                    setTimeout(() => {
                        document.getElementById('recover-email').value = email;
                        document.getElementById('recover-email-confirm').value = email;
                        showViewCallback('verify-code');
                        document.getElementById('verify-email').value = email;
                    }, 100);
                }
                return;
            }
            
            // Crear modal dinámicamente
            const modalHtml = `
                <div class="modal fade" id="verificationCodeModal" tabindex="-1" aria-labelledby="verificationCodeModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header text-white">
                                <h5 class="modal-title" id="verificationCodeModalLabel">Código de Verificación</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p><strong>Email:</strong> ${email}</p>
                                <p><strong>Código de verificación:</strong></p>
                                <div class="alert text-center fs-2 fw-bold mb-3">
                                    ${code}
                                </div>
                                <p class="text-muted small">Este código expira en 10 minutos.</p>
                                
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                <button type="button" class="btn btn-primary" id="continue-to-verify-btn" data-bs-dismiss="modal">
                                    Continuar con el código
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal anterior si existe
            const existingModal = document.getElementById('verificationCodeModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar modal al body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modalElement = document.getElementById('verificationCodeModal');
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
            
            // Manejar el botón de continuar
            document.getElementById('continue-to-verify-btn').addEventListener('click', function() {
                // Pre-llenar el email en la vista de verificación
                document.getElementById('recover-email').value = email;
                document.getElementById('recover-email-confirm').value = email;
                if (showViewCallback) {
                    showViewCallback('verify-code');
                }
                // Esperar un momento para que la vista se muestre antes de pre-llenar
                setTimeout(() => {
                    const verifyEmailInput = document.getElementById('verify-email');
                    if (verifyEmailInput) {
                        verifyEmailInput.value = email;
                    }
                }, 100);
            });
            
            // Limpiar modal cuando se cierre
            modalElement.addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // ==================== INICIALIZACIÓN ====================
        
        document.addEventListener('DOMContentLoaded', () => {
            const loginView = document.getElementById('login-view');
            const registerView = document.getElementById('register-view');
            const forgotPasswordView = document.getElementById('forgot-password-view');
            const verifyCodeView = document.getElementById('verify-code-view');
            const forgotPasswordLink = document.getElementById('forgot-password-link');
            const backToLoginLink = document.getElementById('back-to-login-link');
            const backToRecoverLink = document.getElementById('back-to-recover-link');
            
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const recoverForm = document.getElementById('recover-form');
            const verifyCodeForm = document.getElementById('verify-code-form');
            
            // Tabs de la vista de login
            const tabLogin = document.getElementById('tab-login');
            const tabRegister = document.getElementById('tab-register');
            
            // Tabs de la vista de registro
            const tabLoginReg = document.getElementById('tab-login-reg');
            const tabRegisterReg = document.getElementById('tab-register-reg');

            /**
             * Alterna entre las vistas de Login, Registro, Recuperación de Contraseña y Verificación de Código.
             * @param {string} viewId - 'login', 'register', 'forgot' o 'verify-code'.
             */
            function showView(viewId) {
                // Oculta todas las vistas primero
                loginView.style.display = 'none';
                registerView.style.display = 'none';
                forgotPasswordView.style.display = 'none';
                verifyCodeView.style.display = 'none';

                // Muestra la vista solicitada
                switch(viewId) {
                    case 'login':
                        loginView.style.display = 'block';
                        tabLogin.classList.add('active');
                        tabRegister.classList.remove('active');
                        tabLoginReg.classList.remove('active');
                        tabRegisterReg.classList.add('active');
                        break;
                    case 'register':
                        registerView.style.display = 'block';
                        tabLogin.classList.remove('active');
                        tabRegister.classList.add('active');
                        tabLoginReg.classList.remove('active');
                        tabRegisterReg.classList.add('active');
                        break;
                    case 'forgot':
                        forgotPasswordView.style.display = 'block';
                        break;
                    case 'verify-code':
                        verifyCodeView.style.display = 'block';
                        break;
                }
            }
            
            // ---------------- Lógica de TABS ----------------
            tabLogin.addEventListener('click', () => {
                showView('login');
            });

            tabRegister.addEventListener('click', () => {
                showView('register');
            });

            tabLoginReg.addEventListener('click', () => {
                showView('login');
            });

            tabRegisterReg.addEventListener('click', () => {
                showView('register');
            });
            
            // ---------------- Lógica de Navegación ----------------
            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                showView('forgot');
            });

            backToLoginLink.addEventListener('click', (e) => {
                e.preventDefault();
                showView('login');
            });

            backToRecoverLink.addEventListener('click', (e) => {
                e.preventDefault();
                showView('forgot');
            });

            // Validación en tiempo real para el campo de código
            const verifyCodeInput = document.getElementById('verify-code');
            if (verifyCodeInput) {
                verifyCodeInput.addEventListener('input', function(e) {
                    // Solo permitir números
                    this.value = this.value.replace(/[^0-9]/g, '');
                    // Limitar a 6 dígitos
                    if (this.value.length > 6) {
                        this.value = this.value.slice(0, 6);
                    }
                });

                // Prevenir pegar texto no numérico
                verifyCodeInput.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                    const numbersOnly = pastedText.replace(/[^0-9]/g, '').slice(0, 6);
                    this.value = numbersOnly;
                });
            }

            // ---------------- Manejo de Formularios ----------------
            
            // 1. Manejo de formulario de LOGIN
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value.trim().toLowerCase();
                const password = document.getElementById('password').value;
                
                console.log(`[LOGIN] Intentando iniciar sesión con: ${email}`);

                if (!email || !password) {
                    console.error("[LOGIN] Por favor, complete ambos campos.");
                    showToast('Por favor, complete todos los campos.', 'warning');
                    return;
                }

                // Buscar usuario en localStorage
                let user = findUserByEmail(email);
                
                // Si no se encuentra en localStorage, verificar usuarios demo
                if (!user) {
                    // Verificar usuarios demo hardcodeados
                    if (email === 'atleta@test.com' && password === 'demo123') {
                        // Crear objeto temporal para usuario demo atleta
                        user = {
                            id: 'demo-atleta',
                            email: 'atleta@test.com',
                            password: 'demo123',
                            userType: 'atleta',
                            nombre: 'Demo',
                            apellido: 'Atleta',
                            createdAt: new Date().toISOString(),
                            atleta: createDefaultUserData('atleta')
                        };
                    } else if (email === 'entrenador@test.com' && password === 'demo123') {
                        // Crear objeto temporal para usuario demo entrenador
                        user = {
                            id: 'demo-entrenador',
                            email: 'entrenador@test.com',
                            password: 'demo123',
                            userType: 'entrenador',
                            nombre: 'Demo',
                            apellido: 'Entrenador',
                            createdAt: new Date().toISOString(),
                            entrenador: createDefaultUserData('entrenador')
                        };
                    } else {
                        // Usuario no encontrado
                        showToast('Email o contraseña incorrectos', 'error');
                        return;
                    }
                } else {
                    // Usuario encontrado en localStorage, verificar contraseña
                    if (user.password !== password) {
                        showToast('Email o contraseña incorrectos', 'error');
                        return;
                    }
                }

                // Credenciales correctas
                console.log("[LOGIN] Inicio de sesión exitoso. Redirigiendo...");
                
                // Guardar usuario actual en sessionStorage
                setCurrentUser(user);
                
                // Redirigir según userType
                if (user.userType === 'atleta') {
                    window.location.href = 'atletas/index.html';
                } else if (user.userType === 'entrenador') {
                    window.location.href = 'entrenador/index.html';
                } else {
                    showToast('Tipo de usuario no reconocido', 'error');
                }
            });

            // 2. Manejo de formulario de REGISTRO
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const nombre = document.getElementById('register-nombre').value.trim();
                const apellido = document.getElementById('register-apellido').value.trim();
                const email = document.getElementById('register-email').value.trim().toLowerCase();
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-password-confirm').value;
                const userType = document.querySelector('input[name="userType"]:checked')?.value;

                // Validar que las contraseñas coincidan
                if (password !== confirmPassword) {
                    showToast('Las contraseñas no coinciden', 'error');
                    return;
                }

                // Validar que se haya seleccionado tipo de usuario
                if (!userType) {
                    showToast('Por favor seleccione si es Atleta o Entrenador', 'warning');
                    return;
                }

                // Verificar si el email ya existe
                const existingUser = findUserByEmail(email);
                if (existingUser) {
                    showToast('Este email ya está registrado', 'error');
                    return;
                }

                // Crear objeto usuario con estructura completa
                const userId = generateUserId();
                const defaultData = createDefaultUserData(userType);
                
                const newUser = {
                    id: userId,
                    email: email,
                    password: password,
                    userType: userType,
                    createdAt: new Date().toISOString(),
                    nombre: nombre,
                    apellido: apellido
                };

                // Agregar datos específicos según el tipo de usuario
                if (userType === 'atleta') {
                    newUser.atleta = defaultData;
                } else if (userType === 'entrenador') {
                    newUser.entrenador = defaultData;
                }

                // Guardar usuario en localStorage
                const users = getUsers();
                users.push(newUser);
                saveUsers(users);

                console.log('[REGISTER] Usuario registrado exitosamente:', {
                    id: userId,
                    nombre,
                    apellido,
                    email,
                    userType
                });

                // Mostrar mensaje de éxito y cambiar a vista de login
                showToast('Registro exitoso! Por favor inicie sesión.', 'success', 'Registro completado');
                
                // Limpiar formulario
                registerForm.reset();
                
                // Cambiar a vista de login
                showView('login');
            });

            // 3. Manejo de formulario de RECUPERACIÓN
            recoverForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('recover-email').value.trim().toLowerCase();
                const confirmEmail = document.getElementById('recover-email-confirm').value.trim().toLowerCase();

                if (email !== confirmEmail) {
                    showToast('Los emails no coinciden.', 'error');
                    return;
                }
                
                // Verificar que el email existe en localStorage
                const user = findUserByEmail(email);
                if (!user) {
                    showToast('Este email no está registrado.', 'error');
                    return;
                }
                
                // Generar código de verificación
                const verificationCode = generateVerificationCode();
                saveVerificationCode(email, verificationCode);
                
                // Mostrar código en modal (para simulación - en producción se enviaría por email)
                showVerificationCodeModal(email, verificationCode, showView);
                
                console.log(`[RECOVER] Código de verificación generado para ${email}: ${verificationCode}`);
            });

            // 4. Manejo de formulario de VERIFICACIÓN DE CÓDIGO
            verifyCodeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('verify-email').value.trim().toLowerCase();
                const code = document.getElementById('verify-code').value.trim();
                const newPassword = document.getElementById('verify-new-password').value;
                const confirmPassword = document.getElementById('verify-confirm-password').value;
                
                // Validar formato del código
                if (code.length !== 6 || !/^\d+$/.test(code)) {
                    showToast('El código debe ser de 6 dígitos numéricos.', 'error');
                    return;
                }
                
                // Validar que las contraseñas coincidan
                if (newPassword !== confirmPassword) {
                    showToast('Las contraseñas no coinciden.', 'error');
                    return;
                }
                
                // Validar que la contraseña no esté vacía
                if (!newPassword || newPassword.length < 1) {
                    showToast('La contraseña no puede estar vacía.', 'error');
                    return;
                }
                
                // Validar código
                if (!verifyCode(email, code)) {
                    showToast('Código inválido o expirado. Por favor, solicita un nuevo código.', 'error');
                    return;
                }
                
                // Cambiar contraseña
                if (changeUserPassword(email, newPassword)) {
                    showToast('Contraseña cambiada exitosamente. Puedes iniciar sesión ahora.', 'success', 'Éxito');
                    
                    // Limpiar formularios
                    recoverForm.reset();
                    verifyCodeForm.reset();
                    
                    // Pequeño delay antes de cambiar de vista para que se vea el toast
                    setTimeout(() => {
                        showView('login');
                    }, 500);
                } else {
                    showToast('Error al cambiar la contraseña. Por favor, intenta de nuevo.', 'error');
                }
            });
        });
    </script>
    
    <!-- Bootstrap JS Bundle (necesario para Toasts) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
